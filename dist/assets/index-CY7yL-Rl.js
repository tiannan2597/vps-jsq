(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}})();const x="https://open.er-api.com/v6/latest/CNY",N={USD:"$",EUR:"€",GBP:"£",JPY:"¥",CNY:"¥",HKD:"HK$",AUD:"A$",SGD:"S$",KRW:"₩",TWD:"NT$",CAD:"C$"},e={price:document.getElementById("price"),currency:document.getElementById("currency"),cycles:document.getElementsByName("cycle"),dueDate:document.getElementById("dueDate"),tradeDate:document.getElementById("tradeDate"),customRate:document.getElementById("customRate"),apiRateDisplay:document.getElementById("apiRateDisplay"),refreshBtn:document.getElementById("refreshRateBtn"),refreshIcon:document.getElementById("refreshIcon"),symbolDisplay:document.querySelector(".symbol-display"),finalValue:document.getElementById("finalValue"),originalCurrencyValue:document.getElementById("originalCurrencyValue"),daysRemaining:document.getElementById("daysRemaining"),progressBar:document.getElementById("progressBar"),progressText:document.getElementById("progressText"),priceCNYPreview:document.getElementById("priceCNYPreview"),toast:document.getElementById("toast"),rateLimitTip:document.getElementById("rateLimitTip"),themeToggle:document.getElementById("themeToggle"),themeToggleKnob:document.getElementById("themeToggleKnob")};let l=null;window.addEventListener("DOMContentLoaded",()=>{k(),O(),K(),w(),b(),p()});function b(){const n=S(y,500);[e.price,e.currency,e.dueDate,e.tradeDate,e.customRate].forEach(t=>t.addEventListener("input",()=>{p(),n()})),e.cycles.forEach(t=>t.addEventListener("change",()=>{p(),y()})),e.currency.addEventListener("change",()=>{R(),w(),y()}),e.refreshBtn.addEventListener("click",D),e.themeToggle.addEventListener("click",$)}function S(n,t){let r;return function(...o){clearTimeout(r),r=setTimeout(()=>n.apply(this,o),t)}}function k(){localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.add("dark"),v(!0)):(document.documentElement.classList.remove("dark"),v(!1))}function $(){const n=document.documentElement.classList.toggle("dark");localStorage.theme=n?"dark":"light",v(n)}function v(n){n?(e.themeToggleKnob.classList.add("translate-x-6"),e.themeToggleKnob.classList.remove("translate-x-1")):(e.themeToggleKnob.classList.remove("translate-x-6"),e.themeToggleKnob.classList.add("translate-x-1"))}function L(n,t,r){const o=new Date;o.setTime(o.getTime()+r*60*60*1e3);const a="expires="+o.toUTCString();document.cookie=n+"="+encodeURIComponent(t)+";"+a+";path=/"}function E(n){const t=n+"=",o=decodeURIComponent(document.cookie).split(";");for(let a=0;a<o.length;a++){let s=o[a];for(;s.charAt(0)==" ";)s=s.substring(1);if(s.indexOf(t)==0)return s.substring(t.length,s.length)}return""}function y(){var t;const n={price:e.price.value,currency:e.currency.value,cycle:((t=Array.from(e.cycles).find(r=>r.checked))==null?void 0:t.value)||"365",dueDate:e.dueDate.value,tradeDate:e.tradeDate.value,customRate:e.customRate.value};L("vps_inputs",JSON.stringify(n),24*30)}function O(){const n=E("vps_inputs");if(n)try{const t=JSON.parse(n);if(t.price&&(e.price.value=t.price),t.currency&&(e.currency.value=t.currency),t.dueDate&&(e.dueDate.value=t.dueDate),t.tradeDate&&(e.tradeDate.value=t.tradeDate),t.customRate&&(e.customRate.value=t.customRate),t.cycle){const r=document.querySelector(`input[name="cycle"][value="${t.cycle}"]`);r&&(r.checked=!0)}R()}catch(t){console.error("Cookie parse error",t)}}async function w(){const n=e.currency.value;if(n==="CNY"){T(1,"1.0000");return}const t=`vps_rate_${n}`,r=E(t);if(r)try{const o=JSON.parse(r);T(o.rate,o.rate.toFixed(4))}catch{D(!1)}else D(!1)}async function D(n=!0){if(e.currency.value==="CNY")return;const r="vps_refresh_limit",o=E(r);let a={count:0,resetTime:Date.now()+12*3600*1e3};if(o)try{const s=JSON.parse(o);s.resetTime&&Date.now()<s.resetTime?a=s:a={count:0,resetTime:Date.now()+12*3600*1e3}}catch{}if(n){if(a.count>=2){F();return}a.count++;const s=(a.resetTime-Date.now())/(1e3*3600);L(r,JSON.stringify(a),Math.max(.1,s))}await Y()}async function Y(){const n=e.currency.value;e.refreshIcon.classList.add("spin"),e.apiRateDisplay.textContent="...";try{const r=await(await fetch(x)).json();if(r.result==="success"){const o=r.rates[n];if(o){const a=1/o;T(a,a.toFixed(4));const s=JSON.stringify({rate:a,time:Date.now()});L(`vps_rate_${n}`,s,12),y()}else throw new Error("Currency not found")}else throw new Error("API Error")}catch(t){console.error(t),e.apiRateDisplay.textContent="ERR",e.refreshIcon.classList.remove("spin"),P("获取汇率失败")}}function T(n,t){e.customRate.value=n.toFixed(4),e.apiRateDisplay.textContent=t,e.refreshIcon.classList.remove("spin"),p()}function F(){e.rateLimitTip.classList.add("show"),l&&clearTimeout(l),l=setTimeout(()=>{C()},2e3)}function C(){e.rateLimitTip.classList.remove("show"),l&&(clearTimeout(l),l=null)}window.hideRateLimitTip=C;function P(n){e.toast.textContent=n,e.toast.classList.add("show"),setTimeout(()=>{e.toast.classList.remove("show")},2e3)}function K(){if(e.tradeDate.value&&e.dueDate.value)return;const n=new Date;e.tradeDate.value=I(n);const t=n.getFullYear(),r=new Date(t,10,25);let o;n.getTime()<=r.getTime()?o=r:o=new Date(t+1,10,25),e.dueDate.value=I(o)}function I(n){const t=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0");return`${t}-${r}-${o}`}function R(){const n=e.currency.value;e.symbolDisplay.textContent=N[n]||n}function p(){const n=parseFloat(e.price.value)||0,t=parseFloat(e.customRate.value)||0,r=new Date(e.dueDate.value),o=new Date(e.tradeDate.value);let a=365;for(const m of e.cycles)if(m.checked){a=parseInt(m.value);break}const s=n*t;if(e.priceCNYPreview.textContent=`≈${s.toFixed(2)}元`,isNaN(r.getTime())||isNaN(o.getTime()))return;const d=r-o,i=Math.ceil(d/(1e3*60*60*24)),B=n/a;let f=0,h=0,g=0;if(i<=0)f=0,h=0,g=0;else{f=B*i,h=f*t;let m=a;i>a&&(m=a*Math.ceil(i/a)),g=i/m*100}let u=g;u>100&&(u=100),u<0&&(u=0),e.progressBar.style.width=`${u}%`,e.finalValue.textContent=h.toFixed(2),e.originalCurrencyValue.textContent=`≈ ${f.toFixed(2)} ${e.currency.value}`,e.daysRemaining.textContent=i>0?i:"0",e.progressText.textContent=`${g.toFixed(1)}%`}const c={el:document.getElementById("imageModal"),img:document.getElementById("generatedImage"),loading:document.getElementById("modalLoading"),actions:document.getElementById("modalActions")};function A(){c.el.classList.remove("opacity-100"),setTimeout(()=>{c.el.classList.add("hidden"),c.img.classList.add("hidden"),c.actions.classList.add("hidden"),c.loading.classList.remove("hidden"),c.img.src=""},300)}c.el.addEventListener("click",n=>{n.target===c.el&&A()});
